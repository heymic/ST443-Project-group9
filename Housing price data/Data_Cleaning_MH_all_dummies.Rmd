---
title: "Machine Learning Project"
author: "Michal Heydel"
date: "29 November 2017"
output: pdf_document
---
ignore this libaries, after i need to pick the one we use
```{r warning=FALSE, message=FALSE}
require(Matrix) # matrix transformations
require(glmnet) # ridge, lasso & elastinet
require(xgboost) # gbm
require(randomForest)
require(Metrics) # rmse
require(dplyr) # load this in last so plyr doens't overlap it
require(caret) # one hot encoding
require(scales) # plotting $$
require(e1071) # skewness
require(corrplot) # correlation plot
```

```{r}
Mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

```

```{r}
setwd("C:/Users/Michal/Documents/01- Master Degree/GitHub/ST443-Project-group9/Housing price data")
getwd()
```
```{r}
train = read.csv("train.csv", row.names = "Id", stringsAsFactors=FALSE)
testing_kaggle = read.csv("test.csv", row.names = "Id", stringsAsFactors=FALSE)
```

```{r}
#combining train and test data for quicker data prep
testing_kaggle$SalePrice <- NA
train$isTrain <- 1
testing_kaggle$isTrain <- 0
df <- rbind(train,testing_kaggle)
```

```{r}
hist(df$SalePrice)
```

```{r}
colSums(sapply(df, is.na))
```

```{r warning=FALSE, message=FALSE}
df[,c('PoolQC','PoolArea')] %>%
  group_by(PoolQC) %>%
  summarise(mean = mean(PoolArea), counts = n()) 
```
```{r}
df[is.na(df$Exterior1st),]
```


```{r PoolArea}
df[(df$PoolArea > 0) & is.na(df$PoolQC),c('PoolQC','PoolArea')]
```
```{r}
df[2421,'PoolQC'] = 'Ex'
df[2504,'PoolQC'] = 'Ex'
df[2600,'PoolQC'] = 'Fa'
df$PoolQC[is.na(df$PoolQC)] = 'None'
```


```{r}
garage.cols <- c('GarageArea', 'GarageCars', 'GarageQual', 'GarageFinish', 'GarageCond', 'GarageType')
#df[is.na(df$GarageCond),garage.cols]
```
*Garage Yrblt is NAs when there is no garage in the house - set it to?
```{r GarageYrBlt}
#length(which(df$GarageYrBlt == df$YearBuilt))
df[(df$GarageArea > 0) & is.na(df$GarageYrBlt), c(garage.cols, 'GarageYrBlt')]
df$GarageYrBlt[2127] <- df$YearBuilt[2127]
df[2127, 'GarageQual'] <- Mode(df$GarageQual)
df[2127, 'GarageFinish'] <- Mode(df$GarageFinish)
df[2127, 'GarageCond'] <- Mode(df$GarageCond)
df$GarageYrBlt[which(is.na(df$GarageYrBlt))] <- 0
```


to numeric - 0, to categorical = 'None'
```{r}
for(i in garage.cols){
if (sapply(df[i], is.numeric) == TRUE){
    df[,i][which(is.na(df[,i]))] <- 0
  }
  else{
    df[,i][which(is.na(df[,i]))] <- "None"
  }
}
```

```{r KitchenQual}
df$KitchenQual[which(is.na(df$KitchenQual))] <- Mode(df$KitchenQual)
```

```{r MSZoning MSSubClass}
df[is.na(df$MSZoning),c('MSZoning','MSSubClass')]
table(df$MSZoning, df$MSSubClass)
```
```{r}
df$MSZoning[c(2217, 2905)] = 'RL'
df$MSZoning[c(1916, 2251)] = 'RM'
```

There are 486 Nas in LotFrontage, cannot do much - set the NAs to median. Maybe one can do some grouping.

```{r LotFrontage}
df$LotFrontage[which(is.na(df$LotFrontage))] <- median(df$LotFrontage,na.rm = T)
```

there are 2721  NAs in Alley cannot do much - set them equal to "None"
```{r Alley}
df$Alley[which(is.na(df$Alley))] <- "None"
```

one is missing the rest as before
```{r MasVnrArea MasVnrType}
#df[(df$MasVnrArea > 0) & (is.na(df$MasVnrType)),c('MasVnrArea','MasVnrType')]
df[2611, 'MasVnrType'] = 'BrkFace'
df$MasVnrType[is.na(df$MasVnrType)] = 'None'
df$MasVnrArea[is.na(df$MasVnrArea)] = 0
```

for small number of NAs we apply Mode to the categorical, and median to the continous
```{r}
for(i in colnames(df[,sapply(df, is.character)])){
  if (sum(is.na(df[,i])) < 5){
    df[,i][which(is.na(df[,i]))] <- Mode(df[,i])
  }
}
```


```{r}
for(i in colnames(df[,sapply(df, is.integer)])){
  if (sum(is.na(df[,i])) < 5){
    df[,i][which(is.na(df[,i]))] <- median(df[,i], na.rm = T)
  }
}
```

for large number of NAs we apply string "None" to the categorical as a seperate Level, and 0 to the continous

```{r}
for(i in colnames(df[,sapply(df, is.character)])){
    df[,i][which(is.na(df[,i]))] <- "None"
}
```

we have filled in all the missing values. The remaining ones are the SalesPrice in the predicting Dataset <- is fine!
```{r}
colSums(sapply(df, is.na))
sum(is.na(df)) == 1459
```
#### THE DATA IMPUTING IS DONE BY NOW. END------------------------------------------------------------------
####-------------------------------------------------------------------------------------------------

```{r}
for(i in colnames(df[,sapply(df, is.character)])){
    df[,i] <- as.factor(df[,i])
}
```


```{r}
df$MSSubClass <- as.factor(df$MSSubClass)
df$OverallQual <- as.factor(df$OverallQual)
df$OverallCond <- as.factor(df$OverallCond)


#df$GarageYrBlt <- as.factor(df$GarageYrBlt) # treat as factor as some of them are '0'


#add years as dummies - POSSIBILITY - but a problem appears, the algorithms cannot treat categorical varibles with more than 55levels
#df$YearBuilt <- as.factor(df$YearBuilt)
#df$YearRemodAdd <- as.factor(df$YearRemodAdd)
#df$YrSold <- as.factor(df$YrSold)
```

```{r}
df$SalePrice <- log(df$SalePrice)
```


```{r}
str(df)
```



